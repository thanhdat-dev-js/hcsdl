\section{Phần riêng}
\subsection{Nguyễn Thành Đạt - 1910113}
\subsubsection{Thủ tục insert dữ liệu:}
\textbf{Mô tả chức năng:}\\
Thủ tục them\_dau\_sach dùng để thêm dữ liệu vào bảng dau\_sach với các tham số: (ma, ten ,tac\_gia, the\_loai, gia\_nhap, gia\_niem\_yet, so\_luong, ma\_nha\_xuat\_ban)\\
Và kiểm tra gia\_nhap phải nhỏ hơn gia\_niem\_yet và so\_luong phải > 0.\\
\textbf{Câu lệnh tạo thủ tục:}
\begin{verbatim}
DELIMITER
    $$
CREATE DEFINER = `root`@`localhost` PROCEDURE `them_dau_sach`(
    IN `gia_nhap` DECIMAL(11, 2),
    IN `gia_niem_yet` DECIMAL(11, 2),
    IN `ma_nha_xuat_ban` CHAR(12),
    IN `so_luong` INT(11),
    IN `tac_gia` VARCHAR(50),
    IN `ten` VARCHAR(40),
    IN `the_loai` VARCHAR(255)
)
BEGIN
    DECLARE ma CHAR(12) ;
    SET ma =(
        SELECT MAX(dau_sach.ma)
        FROM dau_sach
    ) ;
    SET ma = next_id(ma) ;
    IF gia_nhap < gia_niem_yet AND so_luong > 0 THEN
    INSERT INTO dau_sach(
        gia_nhap,
        gia_niem_yet,
        ma,
        ma_nha_xuat_ban,
        so_luong,
        tac_gia,
        ten,
        the_loai
    )
    VALUES(
        gia_nhap,
        gia_niem_yet,
        ma,
        ma_nha_xuat_ban,
        so_luong,
        tac_gia,
        ten,
        the_loai
    ) ;
    ELSE 
    SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT
            = "gia niem yet phai lon hon gia nhap va so luong sach phai lon hon 0" ;
    END IF ;
END $$
\end{verbatim}

\textbf{Câu lệnh thực thi thủ tục mẫu:}\\
\textit{Câu lệnh chạy với tham số hợp lệ}
\begin{verbatim}
    CALL them_dau_sach(
        120000,
        200000,
        'NXB000000001',
        20,
        'Thành Đạt',
        'Dạy học SQL',
        'Sách giáo khoa'
    )
\end{verbatim}
\textit{Câu lệnh chạy với tham số không hợp lệ}
\begin{verbatim}
    CALL them_dau_sach(
        240000,
        200000,
        'NXB000000001',
        20,
        'Thành Đạt',
        'Dạy học SQL',
        'Sách giáo khoa'
    )
\end{verbatim}
\textbf{Kết quả màn hình hiển thị từ DBMS:}
\begin{figure}[htp]
    \centering
    \includegraphics[scale=0.46]{images/dat/datcau1a.png}
    % \caption{Caption}
    % \label{fig:my_label}
\end{figure}
\begin{figure}[htp]
    \centering
    \includegraphics[scale=0.7]{images/dat/datcau1b.png}
    % \caption{Caption}
    % \label{fig:my_label}
\end{figure}
\begin{figure}[!htp]
    \centering
    \includegraphics[scale=0.65]{images/dat/datcau1c.png}
    % \caption{Caption}
    % \label{fig:my_label}
\end{figure}
\newpage
\subsubsection{2 Trigger}
\begin{figure}[!htp]
    \centering
    \includegraphics[scale=0.7]{images/dat/datcau2.png}
\end{figure}
\textbf{Trigger thứ nhất}\\
\textbf{Mô tả chức năng:}\\
Trước khi bảng bao\_gom\_online được insert, trigger giam\_so\_luong\_dau\_sach sẽ được chạy để giảm số lượng sách trong bảng dau\_sach. Nếu so\_luong trong bảng bao\_gom\_online lớn hơn so\_luong trong bảng dau\_sach thì thông báo lỗi\\
\textbf{Câu lệnh tạo trigger:}
\begin{verbatim}
DELIMITER 
    $$
CREATE TRIGGER `giam_so_luong_dau_sach`
BEFORE INSERT ON `bao_gom_online` 
FOR EACH ROW 
BEGIN
    DECLARE soluong INT;
    SET soluong = (
    	SELECT so_luong
        FROM dau_sach
        WHERE ma = NEW.ma_dau_sach
    );
    
    IF NEW.so_luong > soluong THEN
       SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT = 'So luong sach khong du';
    ELSE
        UPDATE dau_sach
        SET so_luong = soluong - NEW.so_luong
        WHERE ma = NEW.ma_dau_sach;
    END IF; 
END
    $$
DELIMITER ;
\end{verbatim}
\textbf{Câu lệnh kiểm tra trigger hoạt động:}
\begin{verbatim}
    SELECT so_luong 
    FROM dau_sach
    WHERE ma = 'DSA000000000';
    
    INSERT INTO `bao_gom_online`(`ma_don`, `ma_dau_sach`, `so_luong`)
    VALUES('DHO000000000', 'DSA000000000', '8');

    SELECT so_luong 
    FROM dau_sach
    WHERE ma = 'DSA000000000';
\end{verbatim}
\textbf{Kết quả màn hình hiển thị từ DBMS:}
\begin{figure}[htp]
    \centering 
    \includegraphics[scale=0.46]{images/dat/datcau2a.png}
    \includegraphics[scale=0.7]{images/dat/datcau2b.png}
    \includegraphics[scale=0.66]{images/dat/datcau2c.png}
\end{figure}
\newpage
\textbf{Trigger thứ hai}\\
\textbf{Mô tả chức năng:}\\
Sau khi bảng bao\_gom\_online bị delete, trigger hoan\_so\_luong\_dau\_sach sẽ được chạy để tăng số lượng sách trong bảng dau\_sachg với một lượng bằng  so\_luong trong bảng bao\_gom. 
\textbf{Câu lệnh tạo trigger:}
\begin{verbatim}
DELIMITER $$
    CREATE TRIGGER `hoan_so_luong_dau_sach` 
    AFTER DELETE ON `bao_gom_online` 
    FOR EACH ROW BEGIN
	DECLARE soluong INT;
    SET soluong = (
    	SELECT so_luong
        FROM dau_sach
        WHERE ma = OLD.ma_dau_sach
    );
	UPDATE dau_sach
    SET so_luong = soluong + OLD.so_luong
    WHERE ma = OLD.ma_dau_sach;
END
$$
DELIMITER ;
\end{verbatim}
\textbf{Câu lệnh kiểm tra trigger hoạt động:}
\begin{verbatim}
    SELECT so_luong 
    FROM dau_sach
    WHERE ma = 'DSA000000000';
        
    DELETE FROM bao_gom_online
    WHERE ma_dau_sach = 'DSA000000000';
        
    SELECT so_luong 
    FROM dau_sach
    WHERE ma = 'DSA000000000';
\end{verbatim}
\textbf{Kết quả màn hình hiển thị từ DBMS:}
\begin{figure}[htp]
    \centering
    \includegraphics[scale=0.46]{images/dat/datcau2d.png}
    \includegraphics[scale=0.9]{images/dat/datcau2e.png}
    \includegraphics[scale=0.9]{images/dat/datcau2f.png}
\end{figure}
\newpage

\subsubsection{2 Thủ tục chứa câu SQL:}
\begin{figure}
    \centering
    \includegraphics[scale=0.7]{images/dat/datcau3a.png}
\end{figure}
\textbf{Thủ tục 1}\\
\textbf{Mô tả chức năng}\\
Thủ tục get\_data\_1 với tham số đầu vào ten\_nha\_xuat\_ban là tên của nhà xuât bản dùng để Liệt kê thông tin các đầu sách thuộc nhà xuât bản có tên là ten\_nha\_xuat\_ban

\begin{verbatim}
    DELIMITER
        $$
    CREATE DEFINER = `root`@`localhost` 
    PROCEDURE `get_data_1`(
        IN `ten_nha_xuat_ban` VARCHAR(50)
    )
    BEGIN
    	SELECT
            dau_sach.ten,
            tac_gia,
            the_loai,
            nha_xuat_ban.ten,
            gia_niem_yet
        FROM
            dau_sach,
            nha_xuat_ban
        WHERE
            dau_sach.ma_nha_xuat_ban = nha_xuat_ban.ma 
            AND nha_xuat_ban.ten = ten_nha_xuat_ban;
    END $$
\end{verbatim}
\textbf{Câu lệnh thực thi thủ tục:}\\
\begin{verbatim}
    CALL get_data_1('Kim Đồng');
\end{verbatim}
\textbf{Kết quả màn hình hiển thị từ DBMS:}
\begin{figure}[htp]
    \centering
    \includegraphics[scale=0.46]{images/dat/datcau3b.png}
    \includegraphics[scale=0.9]{images/dat/datcau3c.png}
\end{figure}
\newpage

\textbf{Thủ tục 2}\\
\textbf{Mô tả chức năng}\\
Thủ tục get\_data\_2 với tham số đầu vào so\_luong(là số lượng sách) dùng để liệt kê tên nhà xuất bản có số lượng đầu sách lớn hơn so\_luong

\begin{verbatim}
DELIMITER
    $$
    CREATE DEFINER = `root`@`localhost` 
    PROCEDURE `get_data_2`(
        IN `soluong` INT
    )
    BEGIN
        SELECT
            COUNT(ma_nha_xuat_ban),
            nha_xuat_ban.ten
        FROM
            dau_sach,
            nha_xuat_ban
        WHERE
            dau_sach.ma_nha_xuat_ban = nha_xuat_ban.ma
        GROUP BY
            ma_nha_xuat_ban
        HAVING
            COUNT(ma_nha_xuat_ban) > soluong
        ORDER BY
            COUNT(ma_nha_xuat_ban) ;
END $$
\end{verbatim}
\textbf{Câu lệnh thực thi thủ tục:}
\begin{verbatim}
    CALL get_data_2(4);
\end{verbatim}
\textbf{Kết quả màn hình hiển thị từ DBMS:}
\begin{figure}[htp]
    \centering
    \includegraphics[scale=0.46]{images/dat/datcau3d.png}
    \includegraphics[scale=0.9]{images/dat/datcau3e.png}
\end{figure}
\newpage

\subsubsection{2 Hàm}

\textbf{Hàm 1}\\
\textbf{Mô tả chức năng}\\
Hàm so\_dau\_sach\_gia\_nhap\_lon\_n là hàm tính toán số đầu sách có giá nhập vào lớn hơn n với n là tham số đầu vào kiểu INT, kiểm tra n <= 0 sẽ thông báo lỗi

\begin{verbatim}
DELIMITER
    $$
    CREATE DEFINER=`root`@`localhost` 
    FUNCTION `so_dau_sach_gia_nhap_lon_n` 
    (`gianhap` DECIMAL(11,2)) 
    RETURNS INT(11) 
    BEGIN
    DECLARE total INT; 
    	DECLARE temp INT;
        DECLARE done INT DEFAULT false;  
        DECLARE cur CURSOR FOR SELECT gia_nhap from dau_sach;  
        DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true; 
        IF gianhap <= 0 THEN
    SIGNAL SQLSTATE '45000'
    			SET MESSAGE_TEXT = 'tham số đầu vào (giá nhập) phải > 0';
    END IF;
        SET total = 0;  
        OPEN cur;  
        FETCH cur INTO temp;  
        WHILE(NOT done) 
        DO  
        	IF temp > gianhap
            THEN
            SET total = total + 1;  
            END IF;
            FETCH cur INTO temp;  
        END WHILE;  
    
        CLOSE cur;  
        RETURN total;  
    END$$
DELIMITER ;

\end{verbatim}
\textbf{Câu SELECT với tham số hợp lệ:}
\begin{verbatim}
    SELECT so_dau_sach_gia_nhap_lon_n(200000);
\end{verbatim}

\textbf{Câu SELECT với tham số không hợp lệ:}
\begin{verbatim}
    SELECT so_dau_sach_gia_nhap_lon_n(-10000);
\end{verbatim}
\textbf{Kết quả màn hình hiển thị từ DBMS:}
\begin{figure}[htp]
    \centering
    \includegraphics[scale=0.46]{images/dat/datcau4b.png}
    \includegraphics[scale=0.9]{images/dat/datcau4e.png}
    \includegraphics[scale=0.9]{images/dat/datcau4f.png}
\end{figure}
\newpage

\textbf{Hàm 2}\\
\textbf{Mô tả chức năng}\\
Hàm so\_dau\_sach\_it\_hon\_n\_cuon là hàm tính toán số đầu sách có số lượng cuốn sách hiện tại ít hơn n cuốn với n là tham số đầu vào kiểu INT, kiểm tra nếu n <= 0 thì thông báo lỗi

\begin{verbatim}
DELIMITER
    $$
CREATE DEFINER=`root`@`localhost`
FUNCTION `so_dau_sach_it_hon_n_cuon` 
(`max_sl` INT) 
RETURNS INT(11)
BEGIN
DECLARE total INT; 
	DECLARE temp INT;
    DECLARE done INT DEFAULT false;  
    DECLARE cur CURSOR FOR SELECT so_luong from dau_sach;  
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true; 
    IF max_sl <= 0 THEN
SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT = 'tham số đầu vào max_sl phải > 0';
END IF;
    SET total = 0;  
    OPEN cur;  
    FETCH cur INTO temp;  
    WHILE(NOT done) 
    DO  
    	IF temp < max_sl
        THEN
        SET total = total + 1;  
        END IF;
        FETCH cur INTO temp;  
    END WHILE;  

    CLOSE cur;  
    RETURN total;  
END$$
DELIMITER ;

\end{verbatim}
\textbf{Câu SELECT với tham số hợp lệ:}
\begin{verbatim}
    SELECT so_dau_sach_it_hon_n_cuon(20);
\end{verbatim}

\textbf{Câu SELECT với tham số không hợp lệ:}
\begin{verbatim}
    SELECT so_dau_sach_it_hon_n_cuon(-10);
\end{verbatim}
\textbf{Kết quả màn hình hiển thị từ DBMS:}
\begin{figure}[htp]
    \centering
    \includegraphics[scale=0.46]{images/dat/datcau4a.png}
       \includegraphics[scale=0.9]{images/dat/datcau4c.png}
    \includegraphics[scale=0.7]{images/dat/datcau4d.png}
\end{figure}
\newpage

\subsubsection{Giao diện}